# MCP Security: Комплексная защита AI-систем

[![MCP Security Best Practices](../../../translated_images/ru/03.175aed6dedae133f.webp)](https://youtu.be/88No8pw706o)

_(Нажмите на изображение выше, чтобы посмотреть видео этого урока)_

Безопасность является фундаментальной частью проектирования AI-систем, поэтому мы уделяем ей особое внимание во втором разделе. Это соответствует принципу Microsoft **Secure by Design** из [Secure Future Initiative](https://www.microsoft.com/security/blog/2025/04/17/microsofts-secure-by-design-journey-one-year-of-success/).

Протокол контекста модели (MCP) приносит мощные новые возможности в AI-приложения, одновременно вводя уникальные проблемы безопасности, выходящие за рамки традиционных рисков программного обеспечения. Системы MCP сталкиваются как с устоявшимися проблемами безопасности (безопасное кодирование, принцип наименьших привилегий, безопасность цепочки поставок), так и с новыми специфическими для AI угрозами, включая инъекции подсказок, отравление инструментов, захват сессий, атаки «запутавшийся заместитель», уязвимости передачи токенов и динамическое изменение возможностей.

В этом уроке рассматриваются наиболее критичные риски безопасности в реализациях MCP — охватывая аутентификацию, авторизацию, избыточные разрешения, косвенные инъекции подсказок, безопасность сессий, проблемы «запутавшегося заместителя», управление токенами и уязвимости цепочки поставок. Вы узнаете практические меры контроля и лучшие практики для снижения этих рисков с использованием решений Microsoft, таких как Prompt Shields, Azure Content Safety и GitHub Advanced Security, для усиления вашей MCP-развертки.

## Цели обучения

К концу этого урока вы сможете:

- **Определять специфические угрозы MCP**: Распознавать уникальные риски безопасности в системах MCP, включая инъекции подсказок, отравление инструментов, избыточные разрешения, захват сессий, проблемы «запутавшегося заместителя», уязвимости передачи токенов и риски цепочки поставок
- **Применять меры безопасности**: Внедрять эффективные меры смягчения, включая надежную аутентификацию, доступ по принципу наименьших привилегий, безопасное управление токенами, контроль безопасности сессий и проверку цепочки поставок
- **Использовать решения безопасности Microsoft**: Понимать и развертывать Microsoft Prompt Shields, Azure Content Safety и GitHub Advanced Security для защиты рабочих нагрузок MCP
- **Проверять безопасность инструментов**: Осознавать важность проверки метаданных инструментов, мониторинга динамических изменений и защиты от косвенных инъекций подсказок
- **Интегрировать лучшие практики**: Сочетать устоявшиеся основы безопасности (безопасное кодирование, укрепление серверов, нулевое доверие) с контролями, специфичными для MCP, для комплексной защиты

# Архитектура и меры безопасности MCP

Современные реализации MCP требуют многоуровневых подходов к безопасности, которые охватывают как традиционные риски программного обеспечения, так и специфические угрозы AI. Быстро развивающаяся спецификация MCP продолжает совершенствовать меры безопасности, обеспечивая лучшую интеграцию с архитектурами корпоративной безопасности и устоявшимися лучшими практиками.

Исследования из [Microsoft Digital Defense Report](https://aka.ms/mddr) показывают, что **98% зарегистрированных нарушений можно предотвратить при помощи надежной гигиены безопасности**. Наиболее эффективная стратегия защиты сочетает базовые меры безопасности с контролями, специфичными для MCP — проверенные базовые меры остаются наиболее значимыми для снижения общего риска безопасности.

## Текущая ситуация с безопасностью

> **Примечание:** Эта информация отражает стандарты безопасности MCP по состоянию на **18 декабря 2025 года**. Протокол MCP продолжает быстро развиваться, и будущие реализации могут вводить новые схемы аутентификации и расширенные меры контроля. Всегда обращайтесь к актуальной [спецификации MCP](https://spec.modelcontextprotocol.io/), [репозиторию MCP на GitHub](https://github.com/modelcontextprotocol) и [документации по лучшим практикам безопасности](https://modelcontextprotocol.io/specification/2025-11-25/basic/security_best_practices) для получения последних рекомендаций.

### Эволюция аутентификации MCP

Спецификация MCP значительно эволюционировала в подходах к аутентификации и авторизации:

- **Исходный подход**: Ранние спецификации требовали от разработчиков реализации собственных серверов аутентификации, при этом серверы MCP выступали как OAuth 2.0 Authorization Servers, напрямую управляя аутентификацией пользователей
- **Текущий стандарт (2025-11-25)**: Обновленная спецификация позволяет серверам MCP делегировать аутентификацию внешним провайдерам идентификации (например, Microsoft Entra ID), улучшая безопасность и снижая сложность реализации
- **Безопасность транспортного уровня**: Расширенная поддержка безопасных транспортных механизмов с правильными схемами аутентификации как для локальных (STDIO), так и для удаленных (Streamable HTTP) соединений

## Безопасность аутентификации и авторизации

### Текущие проблемы безопасности

Современные реализации MCP сталкиваются с несколькими проблемами аутентификации и авторизации:

### Риски и векторы атак

- **Неправильная логика авторизации**: Ошибки в реализации авторизации на серверах MCP могут привести к раскрытию конфиденциальных данных и неправильному применению контроля доступа
- **Компрометация OAuth-токенов**: Кража токенов локального сервера MCP позволяет злоумышленникам выдавать себя за серверы и получать доступ к сервисам
- **Уязвимости передачи токенов**: Неправильная обработка токенов создает обходы мер безопасности и пробелы в учете действий
- **Избыточные разрешения**: Сервера MCP с избыточными правами нарушают принцип наименьших привилегий и расширяют поверхность атаки

#### Передача токенов: критический анти-паттерн

**Передача токенов строго запрещена** в текущей спецификации авторизации MCP из-за серьезных последствий для безопасности:

##### Обход мер безопасности
- Серверы MCP и downstream API реализуют критически важные меры безопасности (ограничение частоты запросов, проверка запросов, мониторинг трафика), которые зависят от правильной проверки токенов
- Прямое использование токенов клиентом для API обходит эти важные защиты, подрывая архитектуру безопасности

##### Проблемы учета и аудита  
- Серверы MCP не могут отличить клиентов, использующих токены, выданные upstream, что нарушает цепочки аудита
- Логи downstream серверов ресурсов показывают вводящую в заблуждение информацию о происхождении запросов вместо реальных промежуточных серверов MCP
- Расследование инцидентов и аудит соответствия становятся значительно сложнее

##### Риски утечки данных
- Непроверенные утверждения токенов позволяют злоумышленникам с украденными токенами использовать серверы MCP как прокси для утечки данных
- Нарушения границ доверия позволяют несанкционированный доступ, обходящий предусмотренные меры безопасности

##### Векторы атак через несколько сервисов
- Компрометированные токены, принимаемые несколькими сервисами, позволяют перемещаться по связанным системам
- Нарушаются предположения доверия между сервисами, когда происхождение токенов не может быть проверено

### Меры безопасности и смягчения

**Критические требования безопасности:**

> **ОБЯЗАТЕЛЬНО**: Серверы MCP **НЕ ДОЛЖНЫ** принимать токены, которые явно не были выданы для данного сервера MCP

#### Контроль аутентификации и авторизации

- **Тщательный аудит авторизации**: Проводите комплексные проверки логики авторизации серверов MCP, чтобы гарантировать доступ только для предусмотренных пользователей и клиентов
  - **Руководство по реализации**: [Azure API Management как шлюз аутентификации для серверов MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
  - **Интеграция идентификации**: [Использование Microsoft Entra ID для аутентификации серверов MCP](https://den.dev/blog/mcp-server-auth-entra-id-session/)

- **Безопасное управление токенами**: Внедряйте [лучшие практики Microsoft по проверке и жизненному циклу токенов](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens)
  - Проверяйте соответствие аудитории токена идентичности сервера MCP
  - Реализуйте правильную ротацию и срок действия токенов
  - Предотвращайте повторное использование токенов и несанкционированное использование

- **Защищенное хранение токенов**: Обеспечьте шифрование токенов как в состоянии покоя, так и при передаче
  - **Лучшие практики**: [Руководство по безопасному хранению и шифрованию токенов](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)

#### Реализация контроля доступа

- **Принцип наименьших привилегий**: Предоставляйте серверам MCP только минимально необходимые разрешения для выполнения функций
  - Регулярно пересматривайте и обновляйте разрешения, чтобы предотвратить накопление прав
  - **Документация Microsoft**: [Безопасный доступ с наименьшими привилегиями](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)

- **Ролевой контроль доступа (RBAC)**: Внедряйте детализированные назначения ролей
  - Ограничивайте роли конкретными ресурсами и действиями
  - Избегайте широких или ненужных разрешений, расширяющих поверхность атаки

- **Непрерывный мониторинг разрешений**: Внедряйте постоянный аудит и мониторинг доступа
  - Отслеживайте аномалии в использовании разрешений
  - Быстро устраняйте избыточные или неиспользуемые права

## Специфические угрозы безопасности AI

### Инъекции подсказок и атаки на инструменты

Современные реализации MCP сталкиваются со сложными специфическими для AI векторами атак, которые традиционные меры безопасности не могут полностью предотвратить:

#### **Косвенная инъекция подсказок (междоменная инъекция подсказок)**

**Косвенная инъекция подсказок** — одна из самых критичных уязвимостей в AI-системах с поддержкой MCP. Злоумышленники внедряют вредоносные инструкции в внешний контент — документы, веб-страницы, электронные письма или источники данных, которые AI-системы затем обрабатывают как легитимные команды.

**Сценарии атак:**
- **Инъекция в документы**: Вредоносные инструкции, скрытые в обрабатываемых документах, вызывают непреднамеренные действия AI
- **Эксплуатация веб-контента**: Скомпрометированные веб-страницы с встроенными подсказками, манипулирующими поведением AI при сканировании
- **Атаки через электронную почту**: Вредоносные подсказки в письмах, заставляющие AI-ассистентов раскрывать информацию или выполнять несанкционированные действия
- **Загрязнение источников данных**: Скомпрометированные базы данных или API, поставляющие зараженный контент AI-системам

**Реальные последствия**: Эти атаки могут привести к утечке данных, нарушениям конфиденциальности, генерации вредоносного контента и манипуляциям с взаимодействием пользователей. Для подробного анализа см. [Prompt Injection в MCP (Simon Willison)](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/).

![Prompt Injection Attack Diagram](../../../translated_images/ru/prompt-injection.ed9fbfde297ca877.webp)

#### **Атаки отравления инструментов**

**Отравление инструментов** нацелено на метаданные, определяющие инструменты MCP, используя то, как большие языковые модели интерпретируют описания и параметры инструментов для принятия решений об исполнении.

**Механизмы атак:**
- **Манипуляция метаданными**: Злоумышленники внедряют вредоносные инструкции в описания инструментов, определения параметров или примеры использования
- **Невидимые инструкции**: Скрытые подсказки в метаданных инструментов, которые обрабатываются AI-моделями, но невидимы для пользователей
- **Динамическое изменение инструментов («Rug Pulls»)**: Инструменты, одобренные пользователями, позже модифицируются для выполнения вредоносных действий без ведома пользователя
- **Инъекция параметров**: Вредоносный контент, встроенный в схемы параметров инструментов, влияющий на поведение модели

**Риски размещенных серверов**: Удаленные серверы MCP представляют повышенные риски, так как определения инструментов могут обновляться после первоначального одобрения пользователем, создавая ситуации, когда ранее безопасные инструменты становятся вредоносными. Для полного анализа см. [Атаки отравления инструментов (Invariant Labs)](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks).

![Tool Injection Attack Diagram](../../../translated_images/ru/tool-injection.3b0b4a6b24de6bef.webp)

#### **Дополнительные векторы атак AI**

- **Междоменная инъекция подсказок (XPIA)**: Сложные атаки, использующие контент из нескольких доменов для обхода мер безопасности
- **Динамическое изменение возможностей**: Изменения возможностей инструментов в реальном времени, ускользающие от первоначальных оценок безопасности
- **Отравление окна контекста**: Атаки, манипулирующие большими окнами контекста для скрытия вредоносных инструкций
- **Атаки путаницы модели**: Использование ограничений модели для создания непредсказуемого или небезопасного поведения

### Влияние рисков безопасности AI

**Последствия с высоким уровнем воздействия:**
- **Утечка данных**: Несанкционированный доступ и кража конфиденциальных корпоративных или личных данных
- **Нарушения конфиденциальности**: Раскрытие персональных данных (PII) и конфиденциальной бизнес-информации  
- **Манипуляции системами**: Непреднамеренные изменения критических систем и рабочих процессов
- **Кража учетных данных**: Компрометация токенов аутентификации и учетных данных сервисов
- **Латеральное перемещение**: Использование скомпрометированных AI-систем как точек опоры для более широких сетевых атак

### Решения Microsoft для безопасности AI

#### **AI Prompt Shields: продвинутая защита от инъекций подсказок**

Microsoft **AI Prompt Shields** обеспечивают комплексную защиту от прямых и косвенных инъекций подсказок через несколько уровней безопасности:

##### **Основные механизмы защиты:**

1. **Продвинутое обнаружение и фильтрация**
   - Алгоритмы машинного обучения и методы обработки естественного языка выявляют вредоносные инструкции во внешнем контенте
   - Анализ в реальном времени документов, веб-страниц, писем и источников данных на наличие встроенных угроз
   - Контекстное понимание легитимных и вредоносных шаблонов подсказок

2. **Техники выделения (Spotlighting)**  
   - Разграничение доверенных системных инструкций и потенциально скомпрометированных внешних данных
   - Методы трансформации текста, повышающие релевантность модели и изолирующие вредоносный контент
   - Помогают AI-системам поддерживать правильную иерархию инструкций и игнорировать внедренные команды

3. **Системы разделителей и маркировки данных**
   - Явное определение границ между доверенными системными сообщениями и внешним вводом
   - Специальные маркеры выделяют границы между доверенными и недоверенными источниками данных
   - Четкое разделение предотвращает путаницу инструкций и несанкционированное выполнение команд

4. **Постоянная разведка угроз**
   - Microsoft непрерывно отслеживает новые схемы атак и обновляет защиту
   - Проактивный поиск угроз новых техник инъекций и векторов атак
   - Регулярные обновления моделей безопасности для поддержания эффективности против эволюционирующих угроз

5. **Интеграция с Azure Content Safety**
   - Часть комплексного набора Azure AI Content Safety
   - Дополнительное обнаружение попыток обхода, вредоносного контента и нарушений политики безопасности
   - Унифицированные меры безопасности для компонентов AI-приложений

**Ресурсы по внедрению**: [Документация Microsoft Prompt Shields](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection)

![Microsoft Prompt Shields Protection](../../../translated_images/ru/prompt-shield.ff5b95be76e9c78c.webp)


## Продвинутые угрозы безопасности MCP

### Уязвимости захвата сессий

**Захват сессии** представляет собой критический вектор атаки в состояниях с сохранением состояния MCP, когда неавторизованные лица получают и используют легитимные идентификаторы сессий для выдачи себя за клиентов и выполнения несанкционированных действий.

#### **Сценарии атак и риски**

- **Инъекция подсказок через захват сессии**: Злоумышленники с украденными идентификаторами сессий внедряют вредоносные события в серверы с общим состоянием сессии, что может вызвать вредоносные действия или доступ к конфиденциальным данным
- **Прямое выдавание себя за пользователя**: Украденные идентификаторы сессий позволяют напрямую вызывать сервер MCP, обходя аутентификацию и выдавая злоумышленника за легитимного пользователя
- **Компрометация возобновляемых потоков**: Злоумышленники могут преждевременно завершать запросы, заставляя легитимных клиентов возобновлять с потенциально вредоносным содержимым

#### **Меры безопасности для управления сессиями**

**Критические требования:**
- **Проверка авторизации**: Серверы MCP, реализующие авторизацию, **ДОЛЖНЫ** проверять ВСЕ входящие запросы и **НЕ ДОЛЖНЫ** полагаться на сессии для аутентификации  
- **Безопасная генерация сессий**: Используйте криптографически безопасные, недетерминированные идентификаторы сессий, сгенерированные с помощью безопасных генераторов случайных чисел  
- **Привязка к пользователю**: Привязывайте идентификаторы сессий к информации, специфичной для пользователя, используя форматы типа `<user_id>:<session_id>`, чтобы предотвратить злоупотребления сессиями между пользователями  
- **Управление жизненным циклом сессии**: Реализуйте правильное истечение срока действия, ротацию и аннулирование сессий для ограничения уязвимых периодов  
- **Безопасность транспорта**: Обязательное использование HTTPS для всей коммуникации, чтобы предотвратить перехват идентификаторов сессий  

### Проблема «Смущённого заместителя»

Проблема **смущённого заместителя** возникает, когда серверы MCP выступают в роли прокси-аутентификации между клиентами и сторонними сервисами, создавая возможности для обхода авторизации через эксплуатацию статических идентификаторов клиентов.

#### **Механика атаки и риски**

- **Обход согласия на основе cookie**: Предыдущая аутентификация пользователя создаёт cookie согласия, которые злоумышленники используют через вредоносные запросы авторизации с поддельными URI перенаправления  
- **Кража кода авторизации**: Существующие cookie согласия могут привести к тому, что серверы авторизации пропускают экраны согласия, перенаправляя коды на контролируемые злоумышленником конечные точки  
- **Несанкционированный доступ к API**: Украденные коды авторизации позволяют обменять их на токены и выдавать себя за пользователя без явного одобрения  

#### **Стратегии смягчения**

**Обязательные меры:**
- **Требование явного согласия**: Прокси-серверы MCP, использующие статические идентификаторы клиентов, **ДОЛЖНЫ** получать согласие пользователя для каждого динамически зарегистрированного клиента  
- **Реализация безопасности OAuth 2.1**: Следуйте текущим лучшим практикам безопасности OAuth, включая PKCE (Proof Key for Code Exchange) для всех запросов авторизации  
- **Строгая проверка клиентов**: Реализуйте строгую проверку URI перенаправления и идентификаторов клиентов для предотвращения эксплуатации  

### Уязвимости при передаче токенов  

**Передача токенов** — это явный анти-паттерн, при котором серверы MCP принимают токены клиентов без надлежащей проверки и пересылают их на нижестоящие API, нарушая спецификации авторизации MCP.

#### **Последствия для безопасности**

- **Обход контроля**: Прямое использование токенов клиентом для API обходит критические механизмы ограничения частоты, проверки и мониторинга  
- **Нарушение аудита**: Токены, выданные на верхнем уровне, делают невозможным идентификацию клиента, что нарушает возможности расследования инцидентов  
- **Эксплуатация прокси для утечки данных**: Непроверенные токены позволяют злоумышленникам использовать серверы как прокси для несанкционированного доступа к данным  
- **Нарушение границ доверия**: Доверительные предположения нижестоящих сервисов могут быть нарушены, если происхождение токенов не может быть подтверждено  
- **Расширение атак на несколько сервисов**: Компрометированные токены, принимаемые в нескольких сервисах, позволяют злоумышленникам перемещаться по системе  

#### **Требуемые меры безопасности**

**Обязательные требования:**
- **Проверка токенов**: Серверы MCP **НЕ ДОЛЖНЫ** принимать токены, явно не выданные для сервера MCP  
- **Проверка аудитории**: Всегда проверяйте, что аудитория токена соответствует идентичности сервера MCP  
- **Правильный жизненный цикл токенов**: Реализуйте краткоживущие токены доступа с безопасной ротацией  

## Безопасность цепочки поставок для AI-систем

Безопасность цепочки поставок вышла за рамки традиционных зависимостей программного обеспечения и охватывает всю экосистему AI. Современные реализации MCP должны тщательно проверять и контролировать все компоненты, связанные с AI, поскольку каждый из них может вносить уязвимости, способные скомпрометировать целостность системы.

### Расширенные компоненты цепочки поставок AI

**Традиционные зависимости ПО:**
- Библиотеки и фреймворки с открытым исходным кодом  
- Образы контейнеров и базовые системы  
- Инструменты разработки и конвейеры сборки  
- Компоненты инфраструктуры и сервисы  

**Специфические элементы цепочки поставок AI:**
- **Фундаментальные модели**: Предобученные модели от различных поставщиков, требующие проверки происхождения  
- **Сервисы векторизации**: Внешние сервисы векторизации и семантического поиска  
- **Поставщики контекста**: Источники данных, базы знаний и хранилища документов  
- **Сторонние API**: Внешние AI-сервисы, ML-конвейеры и конечные точки обработки данных  
- **Артефакты моделей**: Веса, конфигурации и варианты дообученных моделей  
- **Источники обучающих данных**: Наборы данных, используемые для обучения и дообучения моделей  

### Комплексная стратегия безопасности цепочки поставок

#### **Проверка компонентов и доверие**
- **Проверка происхождения**: Подтверждайте источник, лицензирование и целостность всех AI-компонентов перед интеграцией  
- **Оценка безопасности**: Проводите сканирование уязвимостей и обзоры безопасности моделей, источников данных и AI-сервисов  
- **Анализ репутации**: Оценивайте историю безопасности и практики поставщиков AI-сервисов  
- **Проверка соответствия**: Убедитесь, что все компоненты соответствуют требованиям безопасности и нормативам организации  

#### **Безопасные конвейеры развертывания**  
- **Автоматизированная безопасность CI/CD**: Интегрируйте сканирование безопасности на всех этапах автоматизированных конвейеров развертывания  
- **Целостность артефактов**: Реализуйте криптографическую проверку всех развертываемых артефактов (код, модели, конфигурации)  
- **Пошаговое развертывание**: Используйте прогрессивные стратегии развертывания с проверкой безопасности на каждом этапе  
- **Доверенные репозитории артефактов**: Развёртывайте только из проверенных, безопасных реестров и хранилищ артефактов  

#### **Непрерывный мониторинг и реагирование**
- **Сканирование зависимостей**: Постоянный мониторинг уязвимостей для всех зависимостей ПО и AI-компонентов  
- **Мониторинг моделей**: Непрерывная оценка поведения моделей, дрейфа производительности и аномалий безопасности  
- **Отслеживание состояния сервисов**: Мониторинг внешних AI-сервисов на предмет доступности, инцидентов безопасности и изменений политики  
- **Интеграция разведданных об угрозах**: Включение потоков угроз, специфичных для безопасности AI и ML  

#### **Контроль доступа и принцип наименьших привилегий**
- **Разграничение прав на уровне компонентов**: Ограничение доступа к моделям, данным и сервисам на основе бизнес-необходимости  
- **Управление сервисными аккаунтами**: Использование выделенных сервисных аккаунтов с минимально необходимыми правами  
- **Сегментация сети**: Изоляция AI-компонентов и ограничение сетевого доступа между сервисами  
- **Контроль через API-шлюзы**: Использование централизованных API-шлюзов для контроля и мониторинга доступа к внешним AI-сервисам  

#### **Реагирование на инциденты и восстановление**
- **Процедуры быстрого реагирования**: Установленные процессы для патчинга или замены скомпрометированных AI-компонентов  
- **Ротация учётных данных**: Автоматизированные системы для ротации секретов, API-ключей и учётных данных сервисов  
- **Возможности отката**: Способность быстро возвращаться к предыдущим проверенным версиям AI-компонентов  
- **Восстановление после нарушений цепочки поставок**: Специфические процедуры реагирования на компрометацию верхнеуровневых AI-сервисов  

### Инструменты безопасности Microsoft и интеграция

**GitHub Advanced Security** обеспечивает комплексную защиту цепочки поставок, включая:  
- **Сканирование секретов**: Автоматическое обнаружение учётных данных, API-ключей и токенов в репозиториях  
- **Сканирование зависимостей**: Оценка уязвимостей для зависимостей и библиотек с открытым исходным кодом  
- **Анализ CodeQL**: Статический анализ кода на предмет уязвимостей и проблем с кодированием  
- **Информация о цепочке поставок**: Видимость состояния и безопасности зависимостей  

**Интеграция с Azure DevOps и Azure Repos:**  
- Бесшовная интеграция сканирования безопасности в платформах разработки Microsoft  
- Автоматические проверки безопасности в Azure Pipelines для AI-нагрузок  
- Применение политик для безопасного развертывания AI-компонентов  

**Внутренние практики Microsoft:**  
Microsoft реализует обширные практики безопасности цепочки поставок во всех продуктах. Подробнее о проверенных подходах читайте в [The Journey to Secure the Software Supply Chain at Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/).  

## Лучшие практики базовой безопасности

Реализации MCP наследуют и развивают существующую в вашей организации базовую безопасность. Усиление фундаментальных практик безопасности значительно повышает общую защиту AI-систем и развертываний MCP.

### Основы безопасности

#### **Практики безопасной разработки**
- **Соответствие OWASP**: Защита от [OWASP Top 10](https://owasp.org/www-project-top-ten/) уязвимостей веб-приложений  
- **Защиты, специфичные для AI**: Реализация контролей для [OWASP Top 10 для LLM](https://genai.owasp.org/download/43299/?tmstv=1731900559)  
- **Безопасное управление секретами**: Использование выделенных хранилищ для токенов, API-ключей и конфиденциальных данных конфигурации  
- **Сквозное шифрование**: Обеспечение безопасной коммуникации во всех компонентах приложения и потоках данных  
- **Валидация входных данных**: Строгая проверка всех пользовательских вводов, параметров API и источников данных  

#### **Укрепление инфраструктуры**
- **Многофакторная аутентификация**: Обязательное MFA для всех административных и сервисных аккаунтов  
- **Управление патчами**: Автоматическое и своевременное обновление операционных систем, фреймворков и зависимостей  
- **Интеграция провайдеров идентичности**: Централизованное управление идентичностями через корпоративные провайдеры (Microsoft Entra ID, Active Directory)  
- **Сегментация сети**: Логическая изоляция компонентов MCP для ограничения возможности латерального перемещения  
- **Принцип наименьших привилегий**: Минимально необходимые права для всех системных компонентов и аккаунтов  

#### **Мониторинг и обнаружение угроз**
- **Полное логирование**: Детальный сбор логов активности AI-приложений, включая взаимодействия клиента и сервера MCP  
- **Интеграция SIEM**: Централизованное управление событиями безопасности для обнаружения аномалий  
- **Поведенческая аналитика**: Мониторинг с использованием AI для выявления необычных паттернов в поведении системы и пользователей  
- **Разведданные об угрозах**: Интеграция внешних потоков угроз и индикаторов компрометации (IOC)  
- **Реагирование на инциденты**: Чётко определённые процедуры обнаружения, реагирования и восстановления после инцидентов безопасности  

#### **Архитектура Zero Trust**
- **Никогда не доверяй, всегда проверяй**: Непрерывная проверка пользователей, устройств и сетевых соединений  
- **Микросегментация**: Гранулярный сетевой контроль, изолирующий отдельные рабочие нагрузки и сервисы  
- **Безопасность, ориентированная на идентичность**: Политики безопасности, основанные на проверенных идентичностях, а не на сетевом расположении  
- **Непрерывная оценка рисков**: Динамическая оценка безопасности на основе текущего контекста и поведения  
- **Условный доступ**: Контроль доступа, адаптирующийся в зависимости от факторов риска, местоположения и доверия к устройству  

### Паттерны интеграции в корпоративной среде

#### **Интеграция с экосистемой безопасности Microsoft**
- **Microsoft Defender for Cloud**: Комплексное управление безопасностью облачной инфраструктуры  
- **Azure Sentinel**: Облачный SIEM и SOAR для защиты AI-нагрузок  
- **Microsoft Entra ID**: Корпоративное управление идентичностями и доступом с политиками условного доступа  
- **Azure Key Vault**: Централизованное управление секретами с поддержкой аппаратных модулей безопасности (HSM)  
- **Microsoft Purview**: Управление данными и соответствие требованиям для источников данных и рабочих процессов AI  

#### **Соответствие и управление**
- **Соответствие нормативам**: Обеспечение соответствия реализаций MCP отраслевым требованиям (GDPR, HIPAA, SOC 2)  
- **Классификация данных**: Правильная категоризация и обработка конфиденциальных данных, обрабатываемых AI-системами  
- **Аудит**: Полное логирование для соответствия нормативам и судебных расследований  
- **Контроль конфиденциальности**: Внедрение принципов privacy-by-design в архитектуру AI-систем  
- **Управление изменениями**: Формальные процессы для проведения обзоров безопасности при изменениях AI-систем  

Эти базовые практики создают надёжную основу безопасности, которая повышает эффективность специфичных для MCP мер и обеспечивает комплексную защиту AI-приложений.

## Ключевые выводы по безопасности

- **Многоуровневый подход к безопасности**: Сочетайте базовые практики безопасности (безопасное кодирование, наименьшие привилегии, проверка цепочки поставок, непрерывный мониторинг) с AI-специфичными контролями для комплексной защиты  

- **Специфические угрозы AI**: Системы MCP сталкиваются с уникальными рисками, включая инъекции подсказок, отравление инструментов, перехват сессий, проблему смущённого заместителя, уязвимости передачи токенов и избыточные права, требующими специализированных мер  

- **Отличная аутентификация и авторизация**: Реализуйте надёжную аутентификацию с использованием внешних провайдеров идентичности (Microsoft Entra ID), обеспечьте правильную проверку токенов и никогда не принимайте токены, явно не выданные для вашего сервера MCP  

- **Предотвращение атак на AI**: Используйте Microsoft Prompt Shields и Azure Content Safety для защиты от косвенных инъекций подсказок и атак отравления инструментов, одновременно проверяя метаданные инструментов и мониторя динамические изменения  

- **Безопасность сессий и транспорта**: Используйте криптографически безопасные, недетерминированные идентификаторы сессий, привязанные к идентичности пользователя, реализуйте правильное управление жизненным циклом сессий и никогда не используйте сессии для аутентификации  

- **Лучшие практики безопасности OAuth**: Предотвращайте атаки смущённого заместителя через явное согласие пользователя для динамически зарегистрированных клиентов, правильную реализацию OAuth 2.1 с PKCE и строгую проверку URI перенаправления  

- **Принципы безопасности токенов**: Избегайте анти-паттернов передачи токенов, проверяйте аудиторию токенов, реализуйте краткоживущие токены с безопасной ротацией и поддерживайте чёткие границы доверия  

- **Комплексная безопасность цепочки поставок**: Относитесь ко всем компонентам экосистемы AI (модели, векторизации, поставщики контекста, внешние API) с той же строгостью безопасности, что и к традиционным зависимостям ПО  

- **Непрерывное развитие**: Следите за быстро меняющимися спецификациями MCP, вносите вклад в стандарты сообщества безопасности и поддерживайте адаптивные меры безопасности по мере развития протокола  

- **Интеграция с безопасностью Microsoft**: Используйте комплексную экосистему безопасности Microsoft (Prompt Shields, Azure Content Safety, GitHub Advanced Security, Entra ID) для усиления защиты развертываний MCP  

## Комплексные ресурсы

### **Официальная документация по безопасности MCP**
- [Спецификация MCP (Актуально: 2025-11-25)](https://spec.modelcontextprotocol.io/specification/2025-11-25/)  
- [Лучшие практики безопасности MCP](https://modelcontextprotocol.io/specification/2025-11-25/basic/security_best_practices)  
- [Спецификация авторизации MCP](https://modelcontextprotocol.io/specification/2025-11-25/basic/authorization)  
- [Репозиторий MCP на GitHub](https://github.com/modelcontextprotocol)  

### **Стандарты безопасности и лучшие практики**
- [Лучшие практики безопасности OAuth 2.0 (RFC 9700)](https://datatracker.ietf.org/doc/html/rfc9700)  
- [OWASP Top 10 для веб-приложений](https://owasp.org/www-project-top-ten/)  
- [OWASP Top 10 для больших языковых моделей](https://genai.owasp.org/download/43299/?tmstv=1731900559)  
- [Отчёт Microsoft Digital Defense](https://aka.ms/mddr)  

### **Исследования и анализ безопасности AI**
- [Инъекция подсказок в MCP (Simon Willison)](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)  
- [Атаки отравления инструментов (Invariant Labs)](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)  
- [Обзор исследований безопасности MCP (Wiz Security)](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)

### **Решения безопасности Microsoft**
- [Документация по Microsoft Prompt Shields](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection)
- [Служба безопасности контента Azure](https://learn.microsoft.com/azure/ai-services/content-safety/)
- [Безопасность Microsoft Entra ID](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Лучшие практики управления токенами Azure](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [Расширенная безопасность GitHub](https://github.com/security/advanced-security)

### **Руководства по внедрению и учебные материалы**
- [Управление API Azure как шлюз аутентификации MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [Аутентификация Microsoft Entra ID с серверами MCP](https://den.dev/blog/mcp-server-auth-entra-id-session/)
- [Безопасное хранение и шифрование токенов (видео)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)

### **Безопасность DevOps и цепочки поставок**
- [Безопасность Azure DevOps](https://azure.microsoft.com/products/devops)
- [Безопасность Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [Путь Microsoft к безопасности цепочки поставок программного обеспечения](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)

## **Дополнительная документация по безопасности**

Для получения комплексных рекомендаций по безопасности обратитесь к этим специализированным документам в этом разделе:

- **[Лучшие практики безопасности MCP 2025](./mcp-security-best-practices-2025.md)** - Полные лучшие практики безопасности для внедрений MCP
- **[Внедрение Azure Content Safety](./azure-content-safety-implementation.md)** - Практические примеры внедрения интеграции Azure Content Safety  
- **[Контроль безопасности MCP 2025](./mcp-security-controls-2025.md)** - Последние методы и средства контроля безопасности для развертываний MCP
- **[Быстрый справочник лучших практик MCP](./mcp-best-practices.md)** - Быстрый справочник по основным практикам безопасности MCP

---

## Что дальше

Далее: [Глава 3: Начало работы](../03-GettingStarted/README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**Отказ от ответственности**:  
Этот документ был переведен с помощью сервиса автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Несмотря на наши усилия по обеспечению точности, имейте в виду, что автоматические переводы могут содержать ошибки или неточности. Оригинальный документ на его исходном языке следует считать авторитетным источником. Для получения критически важной информации рекомендуется обращаться к профессиональному переводу, выполненному человеком. Мы не несем ответственности за любые недоразумения или неправильные толкования, возникшие в результате использования данного перевода.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->